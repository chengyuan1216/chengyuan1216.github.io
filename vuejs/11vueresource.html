<!DOCTYPE html>
<html xmlns:v-on="http://www.w3.org/1999/xhtml">
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
    <link rel="stylesheet" href="../index.css">
    <script src="../index.js" charset="UTF-8"></script>
    <script src="../vue.min.js"></script>
</head>
<body >
<div class="box">
    <h3>什么是vue-resource？</h3>
    <p>
        vue-resource是Vue.js的一款插件，它可以通过XMLHttpRequest或JSONP发起请求并处理响应。也就是说，$.ajax能做的事情，vue-resource插件一样也能做到，而且vue-resource的API更为简洁。
    </p>
    <h3>vue-resource特点</h3>
    <div>
        1. 体积小 <br/>
        vue-resource非常小巧，在压缩以后只有大约12KB，服务端启用gzip压缩后只有4.5KB大小，这远比jQuery的体积要小得多。
        <br/>2. 支持主流的浏览器<br/>
        和Vue.js一样，vue-resource除了不支持IE 9以下的浏览器，其他主流的浏览器都支持。
        <br/>3. 支持Promise API和URI Templates<br/>
        Promise是ES6的特性，Promise的中文含义为“先知”，Promise对象用于异步计算。
        URI Templates表示URI模板，有些类似于ASP.NET MVC的路由模板。
        <br/> 4. 支持拦截器<br/>
        拦截器是全局的，拦截器可以在请求发送前和发送请求后做一些处理。
        拦截器在一些场景下会非常有用，比如请求发送前在headers中设置access_token，或者在请求失败时，提供共通的处理方式。
    </div>

    <h3>vue-resource使用</h3> <br/>
    <mark>引入</mark>
    <pre>
        &ltscript src="js/vue.js">&lt/script>
        &ltscript src="js/vue-resource.js">&lt/script>
    </pre>

    <mark>基本语法</mark>
    <p>
        引入vue-resource后，可以基于全局的Vue对象使用http，也可以基于某个Vue实例使用http。
    </p>
    <pre>
        // 基于全局Vue对象使用http
        Vue.http.get('/someUrl', [options]).then(successCallback, errorCallback);
        Vue.http.post('/someUrl', [body], [options]).then(successCallback, errorCallback);

        // 在一个Vue实例内使用$http
        this.$http.get('/someUrl', [options]).then(successCallback, errorCallback);
        this.$http.post('/someUrl', [body], [options]).then(successCallback, errorCallback);
    </pre>
    <p>
        在发送请求后，使用then方法来处理响应结果，then方法有两个参数，第一个参数是响应成功时的回调函数，第二个参数是响应失败时的回调函数。
        本质上就是一个promise对象。
    </p>

    <h3>底层方法</h3>
    <p>
        全局的Vue.http方法和Vue组件的实例方法this.$http都属于底层方法
    </p>
    <mark>全局调用</mark>
    <pre>
        Vue.http(option);
    </pre>
    <mark>组件实例调用</mark>
    <pre>
        this.$http(option)
    </pre>
    <p>
        这两种调用方式的区别是：
        全局调用和组件实例调用都是接收相同的option参数。都返回Promise对象。不同的是，全局方式回调this指向window，而组建实例调用方式回调指向组件实例。
    </p>
    例：组件实例方式发送POST请求。
    <pre>
        new Vue({
            ready: function () {
                // POST请求
                this.$http({
                    url: '',
                    method: 'POST',
                    // 请求体中发送的数据
                    data: {
                        cat: 1
                    },
                    // 设置请求头
                    headers: {
                        'Content-Type': 'x-www-from-urlencoded'
                    }
                }).then(function () {
                    // 请求成功回调
                }, function () {
                    // 请求失败回调
                });
            }
        });
    </pre>

    <h3>便捷方法</h3>
    <div>
        <strong>resource的七种API：</strong> <br/>
        get(url, [options]) <br/>
        head(url, [options]) <br/>
        delete(url, [options]) <br/>
        jsonp(url, [options]) <br/>
        post(url, [body], [options]) <br/>
        put(url, [body], [options]) <br/>
        patch(url, [body], [options])
    </div>
    <div>
        <strong>都是接受三个参数：</strong> <br/>
        url（字符串），请求地址。可被options对象中url属性覆盖。
        <br/> data（可选，字符串或对象），要发送的数据，可被options对象中的data属性覆盖。
        <br/>options
    </div>

    <pre>
        this.$http.post(
            'http://example.com',
            // 请求体重发送数据给服务端
            {
                cat: 1,
                name: 'newBook'
            },{
                'headers': {
                    'Content-Type': 'x-www-form-urlencoded'
                }
            }).then(function () {
                // 成功回调
            }, function () {
                // 失败回调
        });
    </pre>

    <h3>options对象</h3>
    <ol>
        <li>
            <h4>url</h4>
            string。请求的URL。
        </li>
        <li>
            <h4>method</h4>
            string。请求的HTTP方法，例如：'GET', 'POST'或其他HTTP方法。
        </li>
        <h4>data</h4>
        <li>
            data(对象或字符串)。
            默认值为:'',需要发送给服务端的数据。
            data属性的值对method为POST，PUT，DElETE等请求会作为请求体来传送，对于GET，JSONP等方式的请求将会拼接在URL查询参数中。
        </li>
        <li>
            <h4>body</h4>
            Object, FormData、 string。request body。
        </li>
        <li>
            <h4>params</h4>
            默认值为：{}用来替换url中的模板变量，模板变量中为匹配到的属性添加在URL地址后边作为查询参数。
            <pre>
                Vue.http({
                    url: 'http://example.com/{book}',
                    params: {
                        book: 'vue',
                        cat: 1
                    }
                });

                //最终url为： http//example.com/vue?cat=1
            </pre>
        </li>
        <li>
            <h4>headers</h4>
            request header
        </li>
        <li>
            <h4>jsonp</h4>
            jsonp(字符串)
            默认值为:callback，JSONP请求中回调函数的名字。
            <pre>
                Vue.http({
                    url: 'http://example.com/book',
                    method: 'JSONP',
                    jsonp: 'cb'
                });

                //最终的URL地址为http://example.com/book?cb=xxx
                //xxx 为 vue-resource 生成的随机串。
            </pre>
        </li>

        <li>
            <h4>timeout</h4>
            单位为毫秒的请求超时时间 (0 表示无超时时间)
        </li>
        <li>
            <h4>before</h4>
            请求发送前的处理函数，类似于jQuery的beforeSend函数
        </li>
        <li>
            <h4>progress</h4>
            ProgressEvent回调处理函数
        </li>
        <li>
            <h4>credentials</h4>
            boolean	表示跨域请求时是否需要使用凭证
        </li>
       <li>
            <h4>emulateHTTP	</h4>
           boolean	 发送PUT, PATCH, DELETE请求时以HTTP POST的方式发送，并设置请求头的X-HTTP-Method-Override
        </li>
       <li>
            <h4>emulateJSON</h4>
           boolean	将request body以application/x-www-form-urlencoded content type发送
       </li>
    </ol>

    <h3>response对象</h3>
    <p>
        response对象包含以下属性和方法：
    </p>
    <ol>
        <li>
            方法：
            <ul>
                <li>
                    text()：string	以string形式返回response body
                </li>
                <li>
                    json()：Object	以JSON对象形式返回response body
                </li>
                <li>
                    blob()：Blob	以二进制形式返回response body
                </li>
            </ul>
        </li>
        <li>
            属性;
            <ul>
                <li>
                    ok ：	boolean	响应的HTTP状态码在200~299之间时，该属性为true

                </li>
                <li>
                    status ：	number	响应的HTTP状态码

                </li>
                <li>
                    statusText ：	string	响应的状态文本
                </li>
                <li>
                    headers ：	Object	响应头
                </li>
            </ul>
        </li>
    </ol>

    <h3>GET</h3>
    <p>
        在then方法的回调函数内，你也可以直接使用this，this仍然是指向Vue实例的。
    </p>
    <pre>
        var demo = new Vue({
              el: '#app',
              data: {
                gridColumns: ['customerId', 'companyName', 'contactName', 'phone'],
                gridData: [],
                apiUrl: 'http://211.149.193.19:8080/api/customers'
              },
              ready: function() {
                this.getCustomers()
              },
              methods: {
                getCustomers: function() {

                  this.$http.get(this.apiUrl)
                    .then((response) => {
                      this.$set('gridData', response.data)
                    })
                    .catch(function(response) {
                      console.log(response)
                  })

                }
              }
        })
    </pre>

    <h3>拦截器</h3>
    <p>
        可以全局进行拦截器设置。
        拦截器在发送请求前或响应返回时做一些特殊的处理。
    </p>
    <pre>
        Vue.http.interceptors.push({
            //请求前
            request: function ( request ) {
                // 更改请求类型为POST
                request.method = 'POST';
                return request;
            },
            //响应返回时
            response: function ( response ) {
                // 修改返回数据
                response.data = [{
                    custom: 'custom'
                }];
                return response;
            }
        });
    </pre>
    <p>AJAX请求的loading界面</p>
    <pre>
        Vue.http.interceptors.push((request, next) => {
            // 通过控制 组件的`v-show`值显示loading组件
            loading.show = true;
            next((response) => {
                loading.show = false
                return response
            });
        });
    </pre>

    <h3>学习链接</h3><br/>
    <ol>
        <li>
            <a href="https://segmentfault.com/a/1190000007087934">https://segmentfault.com/a/1190000007087934</a>
        </li>
    </ol>
</div>

</body>
</html>