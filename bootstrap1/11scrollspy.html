<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title></title>
    <link rel="stylesheet" href="../bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="../cbontent.css">
    <style>
        .g { background:#e0e0e0; }
        h1 { background:rgba(255,0,0,0.2); }
        #box {
            width:600px;
            height:400px;
            border:2px solid red;
            overflow:auto;
            position:relative;
        }
        #navbar-example2{

        }
    </style>
</head>
<body class="container"><!--监听body滚动条-->

<nav id="navbar-example2" class="navbar navbar-default navbar-static">
    <ul class="nav navbar-nav">
        <li class="active"><a href="#fat">@fat</a></li>
        <li><a href="#mdo">@mdo</a></li>
        <li><a href="#one">one</a></li>
        <li><a href="#two">two</a></li>
        <li><a href="#three">three</a></li>
    </ul>
</nav>
<div id="box" data-spy="scroll" data-target="#navbar-example2">

    <div id="content" class="container">
        <h4 id="fat">@fat</h4>
        <br/>
        <br/>
        <br/>
        <br/>
        <br/>
        <ul>
            <li>
                用法：
                <ol>
                    <li>
                        监听谁的滚动条？ <br/>
                        给要监听的目标加上 <br/>
                        data-spy="scroll"//交互类型 <br/>
                        data-target="#navbar-example2"//滚动引起的变化目标
                    </li>


                    <li>
                        因滚动而引起变化的目标？ <br/>
                        也就是这里的导航条加上 <br/>
                        id="navbar-example2" <br/>
                        class="navbar navbar-default navbar-static"
                    </li>

                    <li>
                        导航条和内容是通过锚来联系的。
                    </li>

                    <li>
                        注意：
                        <ul>
                            <li>导航条要手动定位，使其脱离文档流</li>
                            <li>被滚动条监听的对象必须有滚动条</li>
                            <li>被滚动条监听的对象和导航条可以不是父子关系</li>
                        </ul>
                    </li>
                </ol>
            </li>
            <li></li>
            <li></li>
        </ul>
        <br/>
        <br/>
        <br/>
        <br/>
        <br/>
        <br/>
        <br/>
        <br/>
        <br/>
        <br/>
        <br/>
        <h4 id="mdo">@mdo</h4>
        <p>hello</p>
        <br/>
        <br/>
        <br/>
        <br/>
        <br/>
        <br/>
        <br/>
        <br/>
        <br/>
        <br/>
        <br/>
        <br/>
        <br/>
        <br/>
        <br/>
        <br/>
        <h4 id="one">one</h4>
        <p>hello</p>
        <br/>
        <br/>
        <br/>
        <br/>
        <br/>
        <br/>
        <br/>
        <br/>
        <br/>
        <br/>
        <br/>
        <br/>
        <br/>
        <br/>
        <br/>
        <br/>
        <h4 id="two">two</h4>
        <p>hello</p>
        <br/>
        <br/>
        <br/>
        <br/>
        <br/>
        <br/>
        <br/>
        <br/>
        <br/>
        <br/>
        <br/>
        <br/>
        <br/>
        <br/>
        <br/>
        <br/>
        <h4 id="three">three</h4>
        <p>hello</p>
        <br/>
        <br/>
        <br/>
        <br/>
        <br/>
        <br/>
        <br/>
        <br/>
        <br/>
        <br/>
        <br/>
        <br/>
        <br/>
        <br/>
        <br/>
        <br/><br/>
        <br/>
        <br/>
        <br/>
        <br/>
        <br/>
        <br/>
        <br/>
        <br/><br/>
        <br/>
        <br/>
        <br/>
        <br/>
        <br/>
        <br/>
        <br/>
        <br/>
    </div>
</div>

<pre>
&ltnav id="navbar-example2" class="navbar navbar-default navbar-static">
    &ltul class="nav navbar-nav"> //导航条
        &ltli class="active">&lta href="#fat">@fat&lt/a>&lt/li>
        &ltli>&lta href="#mdo">@mdo&lt/a>&lt/li>
        &ltli>&lta href="#one">one&lt/a>&lt/li>
        &ltli>&lta href="#two">two&lt/a>&lt/li>
        &ltli>&lta href="#three">three&lt/a>&lt/li>
    &lt/ul>
&lt/nav>
&ltdiv id="box" data-spy="scroll" data-target="#navbar-example2">

    //内容

&lt/div>
</pre>

<h1>源码</h1>
<pre>
+function ($) {
  'use strict';

  // SCROLLSPY CLASS DEFINITION
  // ==========================
  /* 构造函数 */
  function ScrollSpy(element, options) {
    /* body对象 */
    this.$body          = $(document.body)

    /* 滚动监听的元素 */
    this.$scrollElement = $(element).is(document.body) ? $(window) : $(element)

    /* 将ScrollSpy.DEFAULTS 与传进的options参数和并 */
    this.options        = $.extend({}, ScrollSpy.DEFAULTS, options)

    /* 获取选择器 */
    this.selector       = (this.options.target || '') + ' .nav li > a'

    this.offsets        = []
    this.targets        = []
    this.activeTarget   = null
    this.scrollHeight   = 0

    /* 触发scroll.bs.scrollspy事件 this指向$scrollElement */
    this.$scrollElement.on('scroll.bs.scrollspy', $.proxy(this.process, this))

    this.refresh()

    this.process()

  }


  ScrollSpy.VERSION  = '3.3.7'

  ScrollSpy.DEFAULTS = {
    offset: 10
  }

  /* 原型 */

  /*  获取滚动条的高度  */
  ScrollSpy.prototype.getScrollHeight = function () {

    return this.$scrollElement[0].scrollHeight || Math.max(this.$body[0].scrollHeight, document.documentElement.scrollHeight)

    }

  /*    */
  ScrollSpy.prototype.refresh = function () {
    var that          = this
    var offsetMethod  = 'offset'
    var offsetBase    = 0

    this.offsets      = []
    this.targets      = []
    this.scrollHeight = this.getScrollHeight()

    /* 如果不是window对象 */
    if (!$.isWindow(this.$scrollElement[0])) {
      offsetMethod = 'position'
      offsetBase   = this.$scrollElement.scrollTop()
    }

    this.$body
      .find(this.selector)
      .map(function () {
        var $el   = $(this)
        var href  = $el.data('target') || $el.attr('href')
        var $href = /^#./.test(href) && $(href)

        return ($href
          && $href.length
          && $href.is(':visible')
          && [[$href[offsetMethod]().top + offsetBase, href]]) || null
      })
      .sort(function (a, b) { return a[0] - b[0] })
      .each(function () {
        that.offsets.push(this[0])
        that.targets.push(this[1])
      })

  }

  ScrollSpy.prototype.process = function () {
    var scrollTop    = this.$scrollElement.scrollTop() + this.options.offset
    var scrollHeight = this.getScrollHeight()
    var maxScroll    = this.options.offset + scrollHeight - this.$scrollElement.height()
    var offsets      = this.offsets
    var targets      = this.targets
    var activeTarget = this.activeTarget
    var i

    if (this.scrollHeight != scrollHeight) {
      this.refresh()
    }

    if (scrollTop >= maxScroll) {
      return activeTarget != (i = targets[targets.length - 1]) && this.activate(i)
    }

    if (activeTarget && scrollTop < offsets[0]) {
      this.activeTarget = null
      return this.clear()
    }

    for (i = offsets.length; i--;) {
      activeTarget != targets[i]
        && scrollTop >= offsets[i]
        && (offsets[i + 1] === undefined || scrollTop < offsets[i + 1])
        && this.activate(targets[i])
    }
  }

  ScrollSpy.prototype.activate = function (target) {
    this.activeTarget = target

    this.clear()

    var selector = this.selector +
      '[data-target="' + target + '"],' +
      this.selector + '[href="' + target + '"]'

    var active = $(selector)
      .parents('li')
      .addClass('active')

    if (active.parent('.dropdown-menu').length) {
      active = active
        .closest('li.dropdown')
        .addClass('active')
    }

    active.trigger('activate.bs.scrollspy')
  }

  ScrollSpy.prototype.clear = function () {
    $(this.selector)
      .parentsUntil(this.options.target, '.active')
      .removeClass('active')
  }


  // SCROLLSPY PLUGIN DEFINITION
  // ===========================

  function Plugin(option) {

    /* 为什么要用return */
    return this.each(function () {

      /* 获取集合中的一个*/
      var $this   = $(this)

     /* 获取滚动对象上的bs.scrollspy数据 */
      var data    = $this.data('bs.scrollspy')

      /* 判断 option 是否是一个不为 null 的对象 */
      var options = typeof option == 'object' && option

      /* 若果data为null， 则给他赋值 */
      if (!data) $this.data('bs.scrollspy', (data = new ScrollSpy(this, options)))

      /* 如果option是一个字符串，则执行 data[ option ] */
      if (typeof option == 'string') data[option]()

    })

  }

  var old = $.fn.scrollspy

  $.fn.scrollspy             = Plugin
  $.fn.scrollspy.Constructor = ScrollSpy


  // SCROLLSPY NO CONFLICT
  // =====================

  $.fn.scrollspy.noConflict = function () {
    $.fn.scrollspy = old
    return this
  }


  // SCROLLSPY DATA-API
  // ==================

  /* 监听scrollspy事件 */
  $(window).on('load.bs.scrollspy.data-api', function () {

    $('[data-spy="scroll"]').each(function () {

      /* 每一个监听滚动条的对象 */
      var $spy = $(this)

      /* 调用Plugin函数，参数是监听滚动条的对象的data数据 */
      Plugin.call($spy, $spy.data())

    })

  })

}(jQuery);


</pre>

<script src="../jquery.min.js"></script>
<script src="../bootstrap/js/bootstrap.min.js"></script>
</body>
</html>
