<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
    <link rel="stylesheet" href="../index.css">
</head>
<body >
<div class="box">
    <h3>触发历史管理</h3>
    <p>
        <mark>1.通过跳转页面</mark>    <br/>
        用户连续访问不同网址，浏览器自动记录历史记录。<br/><br/>

        <mark>2.hash</mark> <br/>
        hash:<br/>
        网址#后面的东西。<br/>
        原理：<br/>
        不同的hash值关联不同的内容，
        根据某一个hash值通过这种关联找到相应的内容。
        不同的hash值访问同一个页面不同的历史数据。
        特点：<br/>
        （1）网址没有改变。改变的是网址的数据。<br/>
        （2）一个hash值对应一组页面数据。<br/>
        （3）当在新的窗口访问再次访问同一个页面时，就算有hash
        值也找不到对应的数据。由此可知，改变hash值时并没有刷新页面。
        window.location.hash="";//给地址加上一个hash值<br/><br/>

        <h4>onhashchange事件：</h4>
        当hash值发生变化时触发。 <br/>
        window.onhashchange=functiion(){ <br/>
        //window.location.hash <br/>
        根据此时的hash值找到对应的历史内容。 <br/>
        } <br/> <br/>

        <pre>
            window.onload = function(){//35个数随机取7个数
            var oInput = document.getElementById('input1');
            var oDiv = document.getElementById('div1');

            var json = {};//用于存储数据，不同的hash值会有不同的窗口。

            oInput.onclick = function(){

                var num = Math.random();

                var arr = randomNum(35,7);

                json[num] = arr;

                oDiv.innerHTML = arr;

                window.location.hash = num;//给地址添加hash值

            };

            window.onhashchange = function(){

                oDiv.innerHTML = json[window.location.hash.substring(1)];

            };

            function randomNum(iAll,n){

                var arr = [];
                var newArr = [];
                for(var i=1;i<=iAll;i++){
                    arr.push(i);
                }

                for(var i=0;i < n; i++){
                    newArr.push( arr.splice( Math.floor(Math.random()*arr.length) ,1) );
                }

                return newArr;

            }

        };
        </pre>

        <mark>3.pushState</mark><br/>
        html5自带的。 <br/><br/>

        用法：<br/>
        （1）存数据  <br/>
        将页面本次的数据存储。<br/>
        pushState : <br/>
        三个参数 ：数据  标题(都没实现)  地址(可选)<br/>
        数据-----页面数据<br/>
        地址-----更改网址的最后一级地址为指定的虚假地址<br/>
        history.pushState(arr,'',arr);<br/><br/>

        （2）读数据<br/>
        popstate事件 :  读取数据   event.state<br/><br/>

        window.onpopstate = function(ev){<br/>

        //ev.state<br/>

        };<br/>
        注意：<br/>
        （1）服务器下运行。<br/>
        （2）如果有地址参数。<br/>
        网址是虚假的，需在服务器指定对应页面，不然刷新找不到页面。<br/>

        <pre>
            oInput.onclick = function(){

            var arr = randomNum(35,7);

                //history.pushState(arr,'',arr)；
                history.pushState(arr,'');

                oDiv.innerHTML = arr;

            };

            window.onpopstate = function(ev){

                oDiv.innerHTML = ev.state;

                alert(ev.state);

            };

        </pre>
    </p>


</div>

</body>
</html>
